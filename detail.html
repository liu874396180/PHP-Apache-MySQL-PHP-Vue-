<!DOCTYPE html>
<html>
	<head>
		<title>华为商城</title>
		<meta charset="UTF-8" />
		<link rel="stylesheet" type="text/css" href="static/css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="static/css/public.css" />
		<link rel="stylesheet" type="text/css" href="static/css/swiper.min.css">
		<link rel="stylesheet" type="text/css" href="static/css/elementui.css"/>
		<link rel="shortcut icon" href="favicon.ico">
		<script src="static/js/jquery-3.1.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="static/js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="static/js/vue.js"></script>
		<script src="static/js/elementui.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<div id="pdetail">
			<div id="" class="top_gg">
				<a href="">
					<img src="static/image/top_gg.jpg" />
				</a>
			</div>
			<div id="" class="shortcut">
				<div class="layout">
					<div class="s-sub">
						<ul>
							<li>
								<a href="index.html">首页</a>
							</li>
							<li>
								<a href="">华为官网</a>
							</li>
							<li>
								<a href="">荣耀官网</a>
							</li>
							<li>
								<a href="">花粉俱乐部</a>
							</li>
							<li>
								<a href="">帮助中心</a>
							</li>
							<li>
								<a href="">优购码</a>
							</li>
							<li>
								<a href="">企业购</a>
							</li>
						</ul>
					</div>
					<div class="s-right">
						<ul>
							<li>
								<a href="index.html" v-if="!userInfo">未登录</a>
								<a href="javascript:void(0)" v-else>{{userInfo.userName}}</a>
							</li>
							<!--<li>
								<a href="javascript:void(0)" @click="dialogFormVisible = true">注册</a>
							</li>-->
							<li>
								<a href="javascript:void(0)" @click="order">|&emsp;订单</a>
							</li>
							<li>
								<a href="javascript:void(0)" @click="car">|&emsp;购物车</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<!--header-->
			<div class="header">
				<div id="" class="layout">
					<div class="left">
						<div class="logo">
							<a href="index.html">
							<img src="static/image/logo.png" /></a>
						</div>
						<div class="naver">
							<ul id="naver-list">
								<li id="huawei" class="">
									<a href="" target="_blank">
										<span>华为专区</span>
									</a>
								</li>
								<li id="honor" class="">
									<a href="" target="_blank">
										<span>荣耀专区</span>
									</a>
								</li>
								<li id="huawei" class="">
									<a href="" target="_blank">
										<span>HUAWEI P20</span>
									</a>
								</li>
								<li id="honor" class="">
									<a href="" target="_blank">
										<span>荣耀10</span>
									</a>
								</li>
								<li id="huawei" class="">
									<a href="" target="_blank">
										<span>nova 3i</span>
									</a>
								</li>
								<li id="honor" class="">
									<a href="" target="_blank">
										<span>荣耀V10</span>
									</a>
								</li>
							</ul>
						</div>
					</div>
					<!--导航右边部分-->
					<div class="right">

					</div>
				</div>
			</div>
			<div id="" class="layout">
				<p><a href="index.html">首页</a>>手机>华为>{{jsonData.jianJie}}</p>
				<div class="">
					<div id="" class="de-con-left">
						<img :src="'sas/upload/'+jsonData.img"/>
					</div>
					<div id="" class="de-con-right">
						<p class="de-con-right-jianJie">{{jsonData.name}}&emsp;<span style="font-size: 18px;color: #999;">{{jsonData.jianJie}}</span></p>
						<div class="de-product-info">
							<p>价&ensp;&ensp;格：<span style="font-size: 24px;color: #ca141d;"><em>¥</em> {{jsonData.price}}</span></p>
							<p>限时特价： <span>限时优惠300元</span></p>
							<p>整点赠送：<span>10点/16点/20点下单前500赠畅玩手环A2（荣耀指定手机共享）</span></p>
							<p>积分翻倍：<span>活动赠送翻倍积分，积分可抵现~</span></p>
						</div>
						<p>服务说明 已满48元已免运费 由华为商城负责发货，并提供售后服务</p>
						<p>商品编码 2601010038102</p>
						<div class="">
							颜色选择: &emsp;
						    <el-radio v-model="radio_color" label="1" border>宝石蓝</el-radio>
						    <el-radio v-model="radio_color" label="2" border>香槟金</el-radio>
						    <el-radio v-model="radio_color" label="3" border>幻影紫</el-radio>
						    <el-radio v-model="radio_color" label="4" border>海鸥灰</el-radio>
						    <el-radio v-model="radio_color" label="5" border>铃兰白</el-radio>
						</div>
						<div class="" style="margin-top: 10px;">
							选择版本: &emsp;
						    <el-radio v-model="radio_v" label="1" border>全网通6GB+64GB</el-radio>
						    <el-radio v-model="radio_v" label="2" border>全网通6GB+128GB</el-radio>
						</div>
						<div class=""style="margin-top: 10px;">
							<el-row>
							  <el-button style="width: 25%;" @click="addCar">加入购物车</el-button>
							  <el-button type="danger" style="width: 25%;" @click="dialog_order = true">立即下单</el-button>
							</el-row>
						</div>
					</div>
				</div>
			</div>
			<!-- 地址弹窗 -->
			<el-dialog
				title="请先填写收货地址"
				:visible.sync="dialog_order"
				width="30%"
				>
				<el-form :model="form">
					<el-form-item label="收货地址" :label-width="form.formLabelWidth">
					  <el-input v-model="form.address" autocomplete="off"></el-input>
					</el-form-item>
				  </el-form>
				<span slot="footer" class="dialog-footer">
					<el-button @click="dialog_order = false">取 消</el-button>
					<el-button type="primary" @click="sure_order">确 定</el-button>
				</span>
			</el-dialog>
			<!--底部footer版权-->
			<div id="footer">
				<div class="foot">
					<!--<p class="foot_logo"><img src="static/image/flogo.png" /></p>-->
					<p class="">隐私声明 服务协议 Copyright © 2012-2018 华为软件技术有限公司 版权所有 保留一切权利公安备案<br /> 苏公网安备32011402010009号 增值电信业务经营许可证：苏B2-20130048号</p>
					<p class=""></p>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript">
		// 注册
		Vue.component('my-component', {});
		var WEITUOSERVER = new Vue({
			el: '#pdetail',
			data: {
				jsonData: {},
				dialog_order:false, //下单弹窗
				form:{address:"河南省郑州市二七区",formLabelWidth:"120px"},
				dialogTableVisible: false,
        		dialogFormVisible: false,
        		pid:"",
        		radio_color:"1",
        		radio_v:"1",
        		userInfo: window.sessionStorage.user && JSON.parse(window.sessionStorage.user),
			},
			created() {
				this.pid = this.GetQueryString("id");
				this.gatData();
			},
			methods: {
				gatData() {
					var that = this;
					$.ajax({
						type: "GET",
			             url: "php/detail.php",
			             data: {"pid":that.pid,"getdata":"pro_detail"},
			             dataType: "json",
						success: function(res) {
							that.jsonData = res.data[0];
						},
					});
				},
				GetQueryString(name){
				     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
				     var r = window.location.search.substr(1).match(reg);
				     if(r!=null)return  unescape(r[2]); return null;
				},
				// 确定下单
				sure_order(){
					this.dialog_order = false;
					this.order();
				},
				addCar() {
					var that = this;
					var user = window.sessionStorage.user ? JSON.parse(window.sessionStorage.user) :"";
					if(!!user){
						var that = this;
						$.ajax({
							type: "GET",
				             url: "php/detail.php",
				             data: {"pid":that.pid,"userId":user.userId,"name":that.jsonData.name,"price":that.jsonData.price,"img":that.jsonData.img,"jianJie":that.jsonData.jianJie},
				             dataType: "json",
							success: function(res) {
								if(res.resultCode == 200){
									that.$message({
							          message: '恭喜你，添加成功',
							          type: 'success'
							       });
								}else if(res.resultCode == "00"){
									that.$message({
							          message: '请不要重复添加',
							          type: 'warning'
							       });
								}
							},
							error:function(data){
								that.$message({
						          message: '添加失败',
						          type: 'success'
						        });
							}
						});
					}else{
						this.$message({
				          message: '请先登录',
				          type: 'warning'
				        });
					}
				},
				car(){
					if(window.sessionStorage.user){
						window.location.href = "car.html"
					}else{
						this.$message({
				          message: '请先登录',
				          type: 'warning'
				        });
					}
				},
				order(){
					var that = this;
					var user = window.sessionStorage.user ? JSON.parse(window.sessionStorage.user) :"";
					if(!!user){
						var that = this;
						$.ajax({
							type: "GET",
				             url: "php/detail.php",
				             data: {"pid":that.pid,"userId":user.userId,"p_name":that.jsonData.name,"price":that.jsonData.price,"img":that.jsonData.img,"jianJie":that.jsonData.jianJie,"my_address":that.form.address},
				             dataType: "json",
							success: function(res) {
								if(res.resultCode == 200){
									that.$message({
							          message: '恭喜你，下单成功',
							          type: 'success'
							       });
								}else if(res.resultCode == "00"){
									that.$message({
							          message: '请不要重复下单',
							          type: 'warning'
							       });
								}
							},
							error:function(data){
								that.$message({
						          message: '下单失败',
						          type: 'success'
						        });
							}
						});
					}else{
						this.$message({
				          message: '请先登录',
				          type: 'warning'
				        });
					}
				}
			}
		})
	</script>
	
</html>
